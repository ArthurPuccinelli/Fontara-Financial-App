<!DOCTYPE html>
<html lang="pt-BR" class="tw-dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assinar Documentos - Fontara Financial</title>
    <meta
      name="description"
      content="Envie ou use nosso modelo padrão para assinar documentos digitalmente com Fontara Financial e Docusign."
    />
    <link rel="shortcut icon" href="./assets/logo/logo.png" type="image/x-icon" />
    <link rel="stylesheet" href="./css/tailwind-build.css" />
    <link rel="stylesheet" href="./css/index.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.min.css"
      integrity="sha512-dPXYcDub/aeb08c63jRq/k6GaKccl256JQy/AnOq7CAnEZ9FzSL9wSbcZkMp4R26vBsMLFYH4kQ67/bbV8XaCQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <style>
      .form-input-custom {
        @apply tw-block tw-w-full tw-px-4 tw-py-3 tw-border tw-border-gray-300 dark:tw-border-gray-600 tw-rounded-md tw-shadow-sm focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-indigo-500 focus:tw-border-indigo-500 dark:tw-bg-gray-700 dark:tw-text-white tw-text-base;
        min-height: 50px;
      }
      .form-label {
        @apply tw-block tw-text-sm tw-font-medium tw-text-gray-700 dark:tw-text-gray-300 tw-mb-1;
      }
      .form-checkbox {
        @apply tw-h-4 tw-w-4 tw-text-indigo-600 tw-border-gray-300 dark:tw-border-gray-600 tw-rounded focus:tw-ring-indigo-500 dark:tw-bg-gray-700 dark:focus:tw-ring-offset-gray-800;
      }
      .modal-iframe-container {
        flex-grow: 1; 
        display: flex; 
        min-height: 0; 
      }
      .modal-iframe-container iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
      .modal-header {
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
      }
      .dark .modal-header {
        border-bottom: 1px solid rgb(55 65 81);
      }
       .spinner-small {
        border: 3px solid #f3f3f3;
        border-top: 3px solid white; 
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        display: inline-block;
        margin-right: 0.5rem;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body
    class="tw-flex tw-min-h-[100vh] tw-flex-col tw-bg-[#fcfcfc] tw-text-black dark:tw-bg-black dark:tw-text-white"
  >
    <header
      id="mainHeader"
      class="lg:tw-px-4 tw-max-w-[100vw] tw-max-w-lg:tw-mr-auto max-lg:tw-top-0 tw-fixed tw-top-4 lg:tw-left-1/2 lg:tw--translate-x-1/2 tw-z-20 tw-flex tw-h-[60px] tw-w-full tw-text-gray-700 tw-bg-white dark:tw-text-gray-200 dark:tw-bg-[#17181b] tw-px-[3%] tw-rounded-md lg:tw-max-w-5xl tw-shadow-md dark:tw-shadow-gray-700 lg:tw-justify-around lg:!tw-backdrop-blur-lg lg:tw-opacity-[0.99]"
    >
      <a class="tw-flex tw-p-[4px] tw-gap-2 tw-place-items-center" href="index.html"><div class="tw-h-[30px] tw-max-w-[100px]"><img src="./assets/logo/logo.png" alt="Fontara Financial Logo" class="tw-object-contain tw-h-full tw-w-full dark:tw-invert"/></div></a>
      <div class="collapsible-header animated-collapse max-lg:tw-shadow-md" id="collapsed-header-items"><nav class="tw-relative tw-flex tw-h-full max-lg:tw-h-max tw-w-max tw-gap-5 tw-text-base max-lg:tw-mt-[30px] max-lg:tw-flex-col max-lg:tw-gap-5 lg:tw-mx-auto tw-place-items-center"><a class="header-links" href="index.html#hero-section"> Início </a><a class="header-links" href="index.html#casos-de-sucesso"> Sucesso </a><a class="header-links" href="index.html#nossos-servicos"> Serviços </a><div class="tw-relative tw-flex tw-flex-col tw-place-items-center"><div id="nav-dropdown-toggle-0" class="max-lg:tw-max-w-fit tw-flex header-links tw-gap-1 tw-place-items-center"><span class=""> Soluções </span> <i class="tw-text-sm bi bi-chevron-down"></i></div><nav id="nav-dropdown-list-0" data-open="false" class="tw-scale-0 tw-opacity-0 lg:tw-fixed tw-flex lg:tw-top-[80px] lg:tw-left-1/2 lg:tw--translate-x-1/2 tw-w-[90%] tw-rounded-lg max-lg:tw-h-0 max-lg:tw-w-0 lg:tw-h-auto tw-overflow-hidden tw-bg-white dark:tw-bg-[#17181B] tw-duration-300 tw-transition-opacity tw-shadow-lg tw-p-4"><div class="tw-grid max-xl:tw-flex max-xl:tw-flex-col tw-justify-around tw-grid-cols-2 tw-w-full"><a class="header-links tw-flex tw-text-left tw-gap-4 !tw-p-4" href="credito-imobiliario.html"><div class="tw-font-semibold tw-text-3xl"><i class="bi bi-house-door"></i></div><div class="tw-flex tw-flex-col tw-gap-2"><div class="tw-text-lg tw-text-black dark:tw-text-white tw-font-medium">Crédito Imobiliário</div><p>Simulação e aprovação rápida de crédito</p></div></a><a class="header-links tw-flex tw-text-left tw-gap-4 !tw-p-4" href="previdencia-privada.html"><div class="tw-font-semibold tw-text-3xl"><i class="bi bi-shield-shaded"></i></div><div class="tw-flex tw-flex-col tw-gap-2"><div class="tw-text-lg tw-text-black dark:tw-text-white tw-font-medium">Previdência Privada</div><p>Garanta tranquilidade para o seu futuro.</p></div></a><a class="header-links tw-flex tw-text-left tw-gap-4 !tw-p-4" href="seguros.html"><div class="tw-font-semibold tw-text-3xl"><i class="bi bi-umbrella"></i></div><div class="tw-flex tw-flex-col tw-gap-2"><div class="tw-text-lg tw-text-black dark:tw-text-white tw-font-medium">Seguros</div><p>Proteja seu patrimônio e sua família</p></div></a><a class="header-links tw-flex tw-text-left tw-gap-4 !tw-p-4" href="emprestimo-pessoal.html"><div class="tw-font-semibold tw-text-3xl"><i class="bi bi-cash-coin"></i></div><div class="tw-flex tw-flex-col tw-gap-2"><div class="tw-text-lg tw-text-black dark:tw-text-white tw-font-medium">Empréstimo Pessoal</div><p>Crédito para você nos momentos mais difíceis.</p></div></a><a class="header-links tw-flex tw-text-left tw-gap-4 !tw-p-4" href="financiamento.html"><div class="tw-font-semibold tw-text-3xl"><i class="bi bi-receipt-cutoff"></i></div><div class="tw-flex tw-flex-col tw-gap-2"><div class="tw-text-lg tw-text-black dark:tw-text-white tw-font-medium">Financiamento</div><p>Conquiste seus sonhos</p></div></a><a class="header-links tw-flex tw-text-left tw-gap-4 !tw-p-4" href="investimentos.html"><div class="tw-font-semibold tw-text-3xl"><i class="bi bi-graph-up-arrow"></i></div><div class="tw-flex tw-flex-col tw-gap-2"><div class="tw-text-lg tw-text-black dark:tw-text-white tw-font-medium">Investimentos</div><p>Renda fixa, renda variável e tesouro direto.</p></div></a></div></nav></div><a class="header-links" href="index.html#faq"> FAQ </a></nav><div class="lg:tw-mx-4 tw-flex tw-place-items-center tw-gap-[20px] tw-text-base max-md:tw-w-full max-md:tw-flex-col max-md:tw-place-content-center"><button type="button" onclick="toggleMode()" class="header-links tw-text-gray-600 dark:tw-text-gray-300" title="Alternar tema" id="theme-toggle"><i class="bi bi-sun" id="toggle-mode-icon"></i></button><a href="#" aria-label="Acessar sua conta" class="btn tw-flex tw-gap-3 tw-px-3 tw-py-2 tw-transition-transform tw-duration-[0.3s] hover:tw-translate-x-2"><span>Área do Cliente</span><i class="bi bi-arrow-right"></i></a></div></div><button class="bi bi-list tw-absolute tw-right-3 tw-top-3 tw-z-50 tw-text-3xl tw-text-gray-500 lg:tw-hidden" onclick="toggleHeader()" aria-label="menu" id="collapse-btn"></button>
    </header>

    <main class="tw-mt-20 tw-pt-10 tw-pb-10 tw-px-[5%] lg:tw-px-[10%]">
      <div class="tw-container tw-mx-auto"> 
        <h1 class="tw-text-3xl md:tw-text-4xl tw-font-semibold tw-text-center tw-mb-8">Assinatura de Documento via Docusign</h1>
        
        <form id="envelopeForm" class="tw-space-y-6 tw-bg-white dark:tw-bg-gray-800 tw-p-6 md:tw-p-8 tw-rounded-lg tw-shadow-md">
          <div>
            <label for="signerName" class="form-label">Seu Nome Completo:</label>
            <input type="text" name="signerName" id="signerName" required class="form-input-custom" placeholder="Ex: João da Silva">
          </div>

          <div>
            <label for="signerEmail" class="form-label">Seu E-mail:</label>
            <input type="email" name="signerEmail" id="signerEmail" required class="form-input-custom" placeholder="Ex: joao.silva@email.com">
          </div>
          
          <div>
            <label for="emailSubject" class="form-label">Assunto do Documento (para notificação Docusign):</label>
            <input type="text" name="emailSubject" id="emailSubject" required class="form-input-custom" value="Documento Fontara Financial para Assinatura">
          </div>

          <fieldset class="tw-pt-4">
            <legend class="form-label tw-mb-2">Escolha o Documento para Assinatura:</legend>
            <div class="tw-flex tw-items-center tw-mb-2">
              <input id="useDefaultDoc" name="documentChoice" type="radio" value="default" checked class="form-checkbox tw-mr-2">
              <label for="useDefaultDoc" class="form-label tw-cursor-pointer">Usar Contrato Padrão Fontara</label>
            </div>
            <div class="tw-flex tw-items-center">
              <input id="useUploadedDoc" name="documentChoice" type="radio" value="upload" class="form-checkbox tw-mr-2">
              <label for="useUploadedDoc" class="form-label tw-cursor-pointer">Enviar meu próprio documento (PDF)</label>
            </div>
          </fieldset>
          
          <div id="fileUploadContainer" class="tw-hidden"> 
            <label for="uploadedDoc" class="form-label">Selecione o arquivo PDF:</label>
            <input type="file" name="uploadedDoc" id="uploadedDoc" class="form-input-custom" accept=".pdf">
            <p class="tw-mt-1 tw-text-xs tw-text-gray-500 dark:tw-text-gray-400">Apenas arquivos .pdf são permitidos. O documento deve conter a âncora de texto `\s1\` onde a assinatura será posicionada.</p>
          </div>

          <div class="tw-pt-4">
            <button type="submit" id="submitEnvelopeBtn" class="btn tw-w-full tw-flex tw-justify-center tw-items-center tw-py-3 tw-px-4 tw-text-lg">
              <i class="bi bi-pencil-square tw-mr-2"></i><span id="submitBtnText">Assinar</span>
            </button>
          </div>
        </form>
      </div>
    </main>

    <footer class="tw-mt-auto tw-flex tw-flex-col tw-w-full tw-gap-4 tw-text-sm tw-pt-[5%] tw-pb-10 tw-px-[5%] md:tw-px-[10%] tw-text-black dark:tw-text-white max-md:tw-flex-col">
        <div class="tw-flex max-md:tw-flex-col max-md:tw-gap-6 tw-gap-3 tw-w-full tw-place-content-around"><div class="tw-flex tw-h-full tw-w-[250px] tw-flex-col tw-place-items-center tw-gap-6 max-md:tw-w-full"><a href="index.html" class="tw-w-full tw-place-items-center tw-flex tw-flex-col tw-gap-6"><img src="./assets/logo/logo.png" alt="Fontara Financial Logo" class="tw-max-w-[120px] dark:tw-invert"/></a><div class="tw-flex tw-gap-4 tw-text-lg"><a href="https://github.com/PaulleDemon/" aria-label="Github" target="_blank" rel="noopener"><i class="bi bi-github"></i></a><a href="https://twitter.com/pauls_freeman" aria-label="Twitter" target="_blank" rel="noopener"><i class="bi bi-twitter"></i></a><a href="https://www.linkedin.com/" aria-label="Linkedin" target="_blank" rel="noopener"><i class="bi bi-linkedin"></i></a></div></div><div class="tw-flex max-md:tw-flex-col tw-flex-wrap tw-gap-6 tw-h-full tw-w-full tw-justify-around"><div class="tw-flex tw-h-full tw-w-[200px] tw-flex-col tw-gap-4"><h2 class="tw-text-xl">Recursos</h2><div class="tw-flex tw-flex-col tw-gap-3"><a href="#" class="footer-link">Blog Financeiro</a><a href="#" class="footer-link">Simuladores</a><a href="#" class="footer-link">Glossário Financeiro</a><a href="#" class="footer-link">Status dos Serviços</a><a href="#" class="footer-link">Taxas e Tarifas</a></div></div><div class="tw-flex tw-h-full tw-w-[200px] tw-flex-col tw-gap-4"><h2 class="tw-text-xl">Fontara</h2><div class="tw-flex tw-flex-col tw-gap-3"><a href="#" class="footer-link">Sobre Nós</a><a href="#" class="footer-link">Carreiras</a><a href="#" class="footer-link">Imprensa</a><a href="#" class="footer-link">Fale Conosco</a><a href="#" class="footer-link">Compliance</a></div></div><div class="tw-flex tw-h-full tw-w-[200px] tw-flex-col tw-gap-4"><h2 class="tw-text-xl">Legal</h2><div class="tw-flex tw-flex-col tw-gap-3"><a href="#" class="footer-link">Termos de Uso</a><a href="#" class="footer-link">Política de Privacidade</a><a href="#" class="footer-link">Ouvidoria</a></div></div></div></div><hr class="tw-mt-8" /><div class="tw-mt-2 tw-flex tw-gap-2 tw-flex-col tw-text-gray-700 dark:tw-text-gray-300 tw-place-items-center tw-text-[12px] tw-w-full tw-text-center tw-place-content-around"><span>Copyright &#169; 2023-<span id="current-year"></span> Fontara Financial. Todos os direitos reservados.</span><span>Todas as marcas registradas e direitos autorais pertencem aos seus respectivos proprietários.</span></div>
    </footer>

    <div
      class="tw-hidden tw-fixed tw-inset-0 tw-bg-black tw-bg-opacity-75 dark:tw-bg-opacity-80 tw-flex tw-items-center tw-justify-center tw-p-4 tw-z-[9999]" 
      id="docusignSigningModalOverlay" 
      style="z-index: 5000 !important;"
    >
      <div
        class="tw-bg-white dark:tw-bg-gray-800 tw-rounded-lg tw-shadow-xl tw-flex tw-flex-col tw-overflow-hidden tw-w-full tw-max-w-4xl tw-h-[90vh]"
        id="docusignSigningModalContent" 
        style="position: relative; z-index: 5001 !important;"
      >
        <div class="modal-header">
          <h3 class="tw-text-lg tw-font-semibold tw-text-gray-800 dark:tw-text-white">Assinatura do Documento</h3>
          <button
            type="button"
            id="closeDocusignSigningModalBtn"
            class="tw-text-gray-400 hover:tw-text-gray-600 dark:hover:tw-text-gray-200 tw-text-2xl"
            title="Fechar"
          >
            <i class="bi bi-x-lg"></i>
          </button>
        </div>
        <div class="modal-iframe-container tw-flex-grow">
          <iframe id="docusignSigningIframe" src="about:blank" title="Assinatura Docusign" class="tw-w-full tw-h-full"></iframe>
        </div>
      </div>
    </div>

    <script>
      // String Base64 do seu documento PDF padrão (SUBSTITUA PELA SUA STRING REAL)
      const DEFAULT_DOC_BASE64 = "JVBERi0xLjQKJeLjz9MKMSAwIG9iago8PAovVGl0bGUgKP7/KQovQ3JlYXRvciAo/v8pCi9Qcm9kdWNlciAo/v9Ta2lhL1BERiBtODgpCi9Nb2REYXRlIChEOjIwMjQwNTE2MTgwNzM0Wi0wMycGVJPT0JFigovQ3JlYXRpb25EYXRlIChEOjIwMjQwNTE2MTgwNzM0Wi0wMycGVJPT0JFigPjwvcGFnZWxhYmVsICgveHMxXCIpPj4KZW5kb2JqCjIgMCBvYmoKPDwKL1R5cGUgL0NhdGFsb2cKL1BhZ2VzIDMgMCBSCi9MYW5nIChwdC1CUikKL01ldGFkYXRhIDEgMCBSCj4+CmVuZG9iagozIDAgb2JqCjw8Ci9UeXBlIC9QYWdlcwovQ291bnQgMQovS2lkcyBbIDQgMCBSIF0KPj4KZW5kb2JqCjQgMCBvYmoKPDwKL1R5cGUgL1BhZ2UKL1BhcmVudCAzIDAgUgovUmVzb3VyY2VzIDw8Ci9Gb250IDw8Ci9GMSA1IDAgUgovUHJvY1NldCBbIC9QREYgL1RleHQgL0ltYWdlQiAvSW1hZ2VDIC9JbWFnZUkgXQo+PgovTWVkaWFCb3ggWyAwIDAgMjUwIDUwIF0KL0NvbnRlbnRzIDYgMCBSCi9Hcm91cCA8PAovVHlwZSAvR3JvdXAKL1MgL1RyYW5zcGFyZW5jeQovQ1MgL0RldmljZVJHQgovSSB0cnVlCj4+Ci9UYWJzIC9TCj4+CmVuZG9iago1IDAgb2JqCjw8Ci9UeXBlIC9Gb250Ci9TdWJ0eXBlIC9UeXBlMQovTmFtZSAvRjEKL0Jhc2VGb250IC9IZWx2ZXRpY2EKL0VuY29kaW5nIC9XaW5BbnNpRW5jb2RpbmcKPj4KZW5kb2JqCjYgMCBvYmoKPDwKL0xlbmd0aCAzNzE+PgpzdHJlYW0KMiAwIDAgMiAwIDAgbW92ZXRvCjAgMCAwIHJnYgpHCmJ0CjAuODYyNzQ1IDAuODYyNzQ1IDAuODYyNzQ1IHJnCmJ0CjkgMCBDb1NjYW4KL01lc3NhZ2VDb250ZW50ICgvU3BhY2UKMTIgMCAwIDEyIDEwIDUwIHRtCjQgMCAwIDQgMTIgMCAoKQpQUk9QZXJ0aWVzICgwKSAvQ1NTSW5mbzMwMSAvRkFBREFOIEhlbHZldGljYSAvQXBwbGljYWJsZSBUcnVlCi9Eb2N1bWVudElEIDEgMCBSCmFjY2Vzc2liaWxpdHkgL0ZvbnRTaXplIDEyKQpTdGFydExpbmVTZXQgdG9wbW9zdAovRjEgMTIgVGYKKCBTdGFydExpbmUpIFRKOwoyMCAwIHRkCi9GMSA1MiBUZgpodS9YIDAgMCAwIEZpcm1hIC9Tb2Z0TWFzayAvRjEgNTAgMCAxMSA4NSBwb3N0CmVuZFNldHRpbmdzCjEgMCAwIDEgMCAwIHBvc3Rtb2RlL1NwYWNlCjI1MC4wMCA1MC4wMCByZWN0CnQgcG9wCiBTcGFjZSAvU3BhY2UKCiAgQmFzZUZvbnRGYW1pbHkgKEhlbHZldGljYSkKICBDYWNoZUNvbXBsZXRlZCAodHJ1ZSkKICBEZWNvZGVGb3JtYXQgKHRydWUpCiAgRGlzcGxheSAoZmFsc2UpCiAgRW5jb2RpbmdTY2hlbWUgKEFkb2JlU3RhbmRhcmRFbmNvZGluZykKICBGb250RmlsbGluZ1ggMC4wMAogIEZvbnRNYXRyaXggWzEgMCAwIDEgMCAwIF0KICBGb250UmV2aXNpb24gMC4wMAogIEZvbnRTdGFja0hlaWdodCA1MC4wMAogIEZvbnRJZCAxCmVuZG9iagoNCjEgMCAwIDEgMCAwIGNtCmJ0CjIwIDM1IHRkCjAuMCAwLjAgMC4wIHJnCigtIDEtKSBUagplVAplbmRzdHJlYW0KZW5kb2JqCnhyZWYKMCA3CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDAxNSAwMDAwMCBuIAowMDAwMDAwMTgzIDAwMDAwIG4gCjAwMDAwMDAyNjAgMDAwMDAgbiAKMDAwMDAwMDMyNSAwMDAwMCBuIAowMDAwMDAwNTEzIDAwMDAwIG4gCjAwMDAwMDA2MDYgMDAwMDAgbiAKdHJhaWxlcgo8PAovU2l6ZSA3Ci9Sb290IDIgMCBSCi9JbmZvIDEgMCBSCj4+CnN0YXJ0eHJlZgo5ODUKJSVFT0YK";
      const DEFAULT_DOC_NAME = "ContratoPadraoFontara.pdf";
      const DEFAULT_DOC_ID = "1";

      document.addEventListener('DOMContentLoaded', function() {
        const yearSpan = document.getElementById('current-year');
        if (yearSpan) yearSpan.textContent = new Date().getFullYear();

        const envelopeForm = document.getElementById('envelopeForm');
        const useDefaultDocRadio = document.getElementById('useDefaultDoc');
        const useUploadedDocRadio = document.getElementById('useUploadedDoc');
        const fileUploadContainer = document.getElementById('fileUploadContainer');
        const uploadedDocInput = document.getElementById('uploadedDoc');
        const submitEnvelopeBtn = document.getElementById('submitEnvelopeBtn');

        const docusignModalOverlay = document.getElementById('docusignSigningModalOverlay');
        const closeDocusignSigningModalBtn = document.getElementById('closeDocusignSigningModalBtn');
        const docusignIframe = document.getElementById('docusignSigningIframe');
        const mainHeader = document.getElementById('mainHeader'); 
        let originalHeaderZIndex = ''; 

        function showFileUpload(show) {
          if (fileUploadContainer && uploadedDocInput) {
            if (show) {
              fileUploadContainer.classList.remove('tw-hidden');
              uploadedDocInput.required = true;
            } else {
              fileUploadContainer.classList.add('tw-hidden');
              uploadedDocInput.required = false;
              uploadedDocInput.value = '';
            }
          }
        }

        if(useDefaultDocRadio) useDefaultDocRadio.addEventListener('change', () => showFileUpload(false));
        if(useUploadedDocRadio) useUploadedDocRadio.addEventListener('change', () => showFileUpload(true));
        
        if(useDefaultDocRadio && useDefaultDocRadio.checked) showFileUpload(false);
        else if (useUploadedDocRadio && useUploadedDocRadio.checked) showFileUpload(true);

        function openDocusignSigningModal(url) {
          if (docusignIframe && docusignModalOverlay) {
            docusignIframe.src = url;
            docusignModalOverlay.classList.remove('tw-hidden');
            document.body.classList.add('modal-open');
            if (mainHeader) {
              originalHeaderZIndex = mainHeader.style.zIndex; 
              mainHeader.style.zIndex = '10'; 
            }
          }
        }

        function closeDocusignSigningModal() {
          if (docusignIframe && docusignModalOverlay) {
            docusignIframe.src = 'about:blank';
            docusignModalOverlay.classList.add('tw-hidden');
            document.body.classList.remove('modal-open');
            if (mainHeader) {
              mainHeader.style.zIndex = originalHeaderZIndex || ''; 
            }
          }
        }
        
        if(closeDocusignSigningModalBtn) closeDocusignSigningModalBtn.addEventListener('click', closeDocusignSigningModal);
        if (docusignModalOverlay) {
            docusignModalOverlay.addEventListener('click', function(event) {
                if (event.target === docusignModalOverlay) closeDocusignSigningModal();
            });
        }

        if(envelopeForm) {
            envelopeForm.addEventListener('submit', async function(event) {
              event.preventDefault();
              const originalButtonInnerHTML = submitEnvelopeBtn.innerHTML;
              
              if(submitEnvelopeBtn) {
                submitEnvelopeBtn.disabled = true;
                submitEnvelopeBtn.innerHTML = '<div class="spinner-small"></div> Processando...';
              }

              const signerName = document.getElementById('signerName').value;
              const signerEmail = document.getElementById('signerEmail').value;
              const emailSubject = document.getElementById('emailSubject').value;
              const useDefault = useDefaultDocRadio.checked;

              let documentBase64 = '';
              let documentName = '';
              const documentFileExtension = 'pdf'; 
              const documentId = DEFAULT_DOC_ID; 

              try {
                if (useDefault) {
                  documentBase64 = DEFAULT_DOC_BASE64;
                  documentName = DEFAULT_DOC_NAME;
                  if (!documentBase64) {
                    throw new Error("Documento padrão não configurado (Base64 ausente). Verifique a constante DEFAULT_DOC_BASE64.");
                  }
                } else {
                  const file = uploadedDocInput.files[0];
                  if (!file) {
                    throw new Error("Por favor, selecione um arquivo PDF para enviar.");
                  }
                  if (file.type !== "application/pdf") {
                    throw new Error("Apenas arquivos PDF são permitidos para upload.");
                  }
                  documentName = file.name;
                  documentBase64 = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.onerror = error => reject(error);
                    reader.readAsDataURL(file);
                  });
                }

                const clientUserId = `fontara_${signerEmail.replace(/[^a-zA-Z0-9]/g, "")}_${Date.now()}`; 

                const envelopePayload = {
                  emailSubject: emailSubject,
                  documents: [{
                    name: documentName,
                    fileExtension: documentFileExtension,
                    documentId: documentId,
                    documentBase64: documentBase64
                  }],
                  recipients: {
                    signers: [{
                      email: signerEmail,
                      name: signerName,
                      recipientId: "1", 
                      clientUserId: clientUserId, 
                      routingOrder: "1",
                      tabs: {
                        signHereTabs: [{
                          anchorString: "\\s1\\", 
                          anchorXOffset: "0", 
                          anchorYOffset: "10",
                          anchorUnits: "pixels"
                        }]
                      }
                    }]
                  },
                  status: "sent"
                };

                let response = await fetch('/.netlify/functions/docusign-actions', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ action: "CREATE_DYNAMIC_EMBEDDED_ENVELOPE", payload: envelopePayload })
                });

                if (!response.ok) {
                  const errorData = await response.json().catch(() => ({ error: `Erro ao criar envelope: ${response.statusText} (Status: ${response.status})` }));
                  throw new Error(errorData.error || `Erro HTTP ${response.status} ao criar envelope.`);
                }
                const envelopeResult = await response.json();
                const envelopeId = envelopeResult.envelopeId;

                if (!envelopeId) throw new Error("ID do envelope não foi retornado pela função.");
                
                const recipientViewPayload = {
                  envelopeId: envelopeId,
                  signerEmail: signerEmail,
                  signerName: signerName,
                  signerClientUserId: clientUserId,
                  returnUrl: `${window.location.origin}/agradecimento/obrigado.html?recipientName=${encodeURIComponent(signerName)}&event=signing_complete&envelopeId=${envelopeId}`
                };

                response = await fetch('/.netlify/functions/docusign-actions', {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ action: "GET_EMBEDDED_SIGNING_URL", payload: recipientViewPayload })
                });

                if (!response.ok) {
                  const errorData = await response.json().catch(() => ({ error: `Erro HTTP ${response.status}: ${response.statusText}` }));
                  throw new Error(errorData.error || `Falha ao obter URL de assinatura.`);
                }
                const signingResult = await response.json();
                const signingUrl = signingResult.signingUrl;

                if (signingUrl) {
                  openDocusignSigningModal(signingUrl);
                } else {
                  throw new Error("URL de assinatura não retornada.");
                }

              } catch (error) {
                console.error("Erro no processo Docusign:", error);
                alert(`Ocorreu um erro: ${error.message}`);
              } finally {
                if(submitEnvelopeBtn) {
                    submitEnvelopeBtn.disabled = false;
                    submitEnvelopeBtn.innerHTML = originalButtonInnerHTML; 
                }
              }
            });
        }
      });
    </script>
    <script src="./scripts/components.js"></script>
    <script src="./scripts/index.js"></script>
  </body>
</html>